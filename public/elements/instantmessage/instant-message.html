<link rel="import" href="/platform/bower_components/polymer/polymer.html">
<link rel="import" href="/platform/bower_components/core-ajax/core-ajax.html">
<link rel="import" href="/platform/bower_components/core-style/core-style.html">
<link rel="import" href="/platform/bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="/platform/bower_components/core-menu/core-menu.html">
<link rel="import" href="/platform/bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="/platform/bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="/platform/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/platform/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/platform/bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="/platform/bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="/platform/bower_components/paper-item/paper-item.html">
<link rel="import" href="/platform/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/platform/bower_components/core-icon/core-icon.html">
<link rel="import" href="/platform/bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="/platform/bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="/platform/bower_components/paper-input/paper-input.html">
<link rel="import" href="/platform/bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="/platform/bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="/platform/bower_components/paper-toast/paper-toast.html">

<link rel="import" href="/platform/bower_components/core-header-panel/core-header-panel.html">

<link rel="import" href="/platform/home-container.html">
<link rel="import" href="/platform/elements/member-select/member-element.html">
<link rel="import" href="/platform/elements/member-select/member-select.html">
<link rel="import" href="/platform/elements/app-globals/app-globals.html">

<link rel="import" href="../display-message/display-message.html">
<link rel="import" href="../event-infinite-scroll/event-infinite-scroll.html">
<link rel="import" href="../imchannels/im-channels-mixed.html">
<link rel="import" href="../imhistory/im-history.html">

<polymer-element name="instant-message" attributes="channelName">
    <template>
        <app-globals id="globals"></app-globals>
        <link rel="stylesheet" type="text/css" href="instant-message.css">
        <core-style ref="theme"></core-style>

        <home-container>
            <div class="title" horizontal layout center>
                <div flex>
                    {{ channelName }}
                </div>
                <div horizontal end-justified layout>
                    <core-icon-button id="menuButton" class='{{ {narrowShow :!narrow} | tokenList }}' icon="menu"
                                      on-tap="{{togglePanel}}"></core-icon-button>
                </div>
            </div>

            <div class="mainBackground" horizontal layout fit>
                <core-drawer-panel id="drawerPanel" narrow="{{narrow}}" rightDrawer>
                    <paper-action-dialog id="connectingDialog" backdrop autoCloseDisabled>
                        <p>{{connectinStatus}}</p>
                    </paper-action-dialog>

                    <div id="forbiddenDiv" hidden main four flex horizontal layout center center-justified>
                        <div style="font-size: 3em; font-weight: bold;">
                            You are not allowed to access this channel
                        </div>
                    </div>
                    <div id="historyAndInput" main four flex vertical layout class="mainBgColor">

                        <div id="imHistory" is="im-history" flex channel="{{$.imChannels.channel}}"
                             unread="{{$.imChannels.unread}}"
                             latestChannelMessage="{{$.imChannels.latestChannelMessage}}"
                             on-message-seen="{{ handleMessageSeen }}"
                             on-message-notify="{{ handleMessageNotify}}"></div>

                        <div layout horizontal center>
                            <div id="inputbox" on-tap="{{boxTapped}}" flex>
                                <div layout horizontal>
                                    <paper-autogrow-textarea id="messageInput" maxRows="6" on-keydown="{{keyDown}}"
                                                             on-input="{{inputChanging}}" flex>
                                        <textarea row="1" id="textInput" value="{{message}}"></textarea>
                                    </paper-autogrow-textarea>
                                </div>
                            </div>
                            <div layout horizontal center>
                                <span id='informationButton' class="input-group-addon "
                                      on-tap="{{onClickInfomation}}">!</span>
                            </div>
                        </div>
                    </div>

                    <div id='imPanel' drawer>
                        <div id="imChannels" is="im-channels-mixed" channelName="{{channelName}}" vertical layout></div>
                    </div>

                </core-drawer-panel>
            </div>

            <paper-dialog id="informationDialog" transition="core-transition-center" heading="Manual">
                <p>1. ENTER to send</p>

                <p>2. SHIFT + ENTER to have newline</p>

                <p>3. Code Snippet

                <div layout horizontal center>
                    <div>
                        Input:
                        <pre>{{codeSnippetExample}}</pre>
                    </div>
                    <div>
                        Display:
                        <display-code-snippet-message text="{{codeSnippetExample}}"></display-code-snippet-message>
                    </div>
                </div>
                </p>
            </paper-dialog>


        </home-container>
    </template>

    <script src="../../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../../bower_components/async/lib/async.js"></script>
    <script src="../../bower_components/lodash/dist/lodash.min.js"></script>
    <script src="instant-message.web.js"></script>
</polymer-element>